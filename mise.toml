[tools]
ctlptl = "0.8.43"
helm = "4.0.2"
kind = "0.30.0"
kubectl = "1.34.2"
tilt = "0.36.0"

[tasks."local:helm:deps"]
description = "Build Helm chart dependencies"
sources = ["charts/immich/Chart.yaml", "charts/immich/Chart.lock"]
outputs = ["charts/immich/charts/*.tgz"]
run = "helm dependency build charts/immich"

[tasks."local:cluster:up"]
description = "Create the local Kind cluster with registry"
run = "ctlptl apply -f local/clusters.yaml"

[tasks."local:cluster:down"]
description = "Delete the local Kind cluster"
run = "ctlptl delete -f local/clusters.yaml"

[tasks."local:up"]
description = "Start the local development environment"
depends = ["local:cluster:up", "local:helm:deps"]
run = "tilt up --file local/Tiltfile"

[tasks."local:ci"]
description = "Run Tilt in CI mode for validation"
depends = ["local:cluster:up", "local:helm:deps"]
run = "tilt ci --file local/Tiltfile"

